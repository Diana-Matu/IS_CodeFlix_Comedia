---
import { getMovieById } from "../../services/movies";

const { id } = Astro.params;

// Intentamos obtener el detalle (getMovieById maneja movie -> tv fallback)
let movie = null;
try {
  if (!id) {
    throw new Error("ID no proporcionado en la URL.");
  }
  movie = await getMovieById(id);
} catch (err) {
  console.error("Error fetching movie by id:", err);
  movie = null;
}
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>{movie ? (movie.title ?? movie.name) : `Movie ${id}`}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body class="body">
    <main class="detail">
      <button class="back-btn" onclick="history.back()">← Volver</button>

      {movie ? (
        <section class="content">
          <img
            src={movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : "https://via.placeholder.com/500x750?text=No+Image"}
            alt={movie.title ?? movie.name}
            class="poster"
          />

          <div class="info">
            <h1>{movie.title ?? movie.name}</h1>
            <p class="rating">⭐ {movie.vote_average ?? "—"} • {movie.release_date ?? movie.first_air_date ?? ""}</p>
            <p class="overview">{movie.overview}</p>
          </div>
        </section>
      ) : (
        <p class="not-found">No se encontró la película/serie — revisa la consola.</p>
      )}
    </main>

    <footer class="footer">
      <p class="brand">CODEFLIX</p>
      <p>Disfruta lo mejor del cine con tecnología y estilo</p>
      <p class="copy">© 2025 Codeflix. Todos los derechos reservados.</p>
    </footer>
  </body>
</html>

<style>
  .body {
    background: #0a0a09;
    color: #fff;
    font-family: system-ui, sans-serif;
    margin: 0;
    padding: 0;
    animation: fade-in 0.6s ease forwards;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .detail {
    flex: 1;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
  }

  .back-btn {
    align-self: flex-start;
    margin-left: 2rem;
    background: none;
    border: 2px solid #ffea00;
    color: #ffea00;
    border-radius: 50px;
    padding: 0.6rem 1.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .back-btn:hover {
    background-color: #ffea00;
    color: #000;
    transform: scale(1.05);
  }

  .content {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2.5rem;
    max-width: 1000px;
    flex-wrap: wrap;
    text-align: center;
  }

  .poster {
    width: 260px;
    border-radius: 12px;
    box-shadow: 0 0 25px #ffea00;
    transition: transform 0.6s ease, box-shadow 0.6s ease;
  }

  .poster:hover {
    transform: scale(1.05);
    box-shadow: 0 0 35px #ffea00;
  }

  .info {
    max-width: 550px;
  }

  h1 { color: #ffea00; font-size: 2rem; margin-bottom: 0.5rem; }
  .rating { color: #ccc; margin-bottom: 1rem; font-size: 1.1rem; }
  .overview { color: #ddd; line-height: 1.5; font-size: 1rem; }
  .not-found { color: #ffb86b; margin-top: 2rem; }

  .footer { text-align:center; padding:1.5rem 0; border-top:1px solid #ffea00; background:#000; font-size:0.9rem; }
  .footer .brand { color: #ffea00; font-weight:700; letter-spacing:1.5px; font-size:1.1rem; }
  .footer .copy { color:#777; font-size:0.75rem; margin-top:0.4rem; }

  @keyframes fade-in { from { opacity:0; transform: translateY(15px); } to { opacity:1; transform: translateY(0); } }
</style>
